<!doctype html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>城际同行平台 · 乘客&司机</title>
  <meta name="description" content="一个面向两类用户（乘客/司机）的简易原型：司机发布班次、乘客按城市与日期筛选并下单。纯前端可直接部署。" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .fade-in { animation: fadeIn .5s ease both; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px);} to { opacity: 1; transform: translateY(0);} }
    .chip{ @apply inline-flex items-center rounded-full border px-2 py-0.5 text-xs; }
    input, select, textarea{ @apply rounded-xl border border-slate-300 px-3 py-2 outline-none focus:ring-2 focus:ring-black; }
    label{ @apply text-sm font-medium; }
  </style>
</head>
<body class="antialiased text-slate-800 bg-slate-50 min-h-screen">
  <header class="sticky top-0 z-50 bg-white/80 backdrop-blur border-b border-slate-200">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="flex h-16 items-center justify-between">
        <div class="inline-flex items-center gap-2 font-semibold">
          <span class="inline-block h-8 w-8 rounded-2xl bg-black"></span>
          <span>城际同行</span>
        </div>
        <nav class="hidden md:flex items-center gap-6 text-sm">
          <a href="#passenger" class="hover:text-black">乘客</a>
          <a href="#driver" class="hover:text-black">司机</a>
          <a href="#how" class="hover:text-black">使用说明</a>
        </nav>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-10">
    <div class="grid lg:grid-cols-3 gap-8">
      <!-- 左侧：搜索/发布面板 -->
      <section class="lg:col-span-2 space-y-8">
        <!-- 乘客面板 -->
        <div id="passenger" class="rounded-2xl bg-white border border-slate-200 p-6 shadow-sm fade-in">
          <div class="flex items-center justify-between gap-4">
            <h2 class="text-xl font-bold">乘客 · 查找与预约</h2>
            <span class="chip border-slate-300">MVP 原型</span>
          </div>
          <p class="mt-1 text-sm text-slate-600">按<strong>出发城市</strong>、<strong>到达城市</strong>和<strong>日期</strong>筛选司机班次；支持 seats≥需求 的匹配。</p>
          <div class="mt-4 grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <div>
              <label>出发城市</label>
              <input id="p_from" placeholder="例如：上海" />
            </div>
            <div>
              <label>到达城市</label>
              <input id="p_to" placeholder="例如：杭州" />
            </div>
            <div>
              <label>日期</label>
              <input id="p_date" type="date" />
            </div>
            <div>
              <label>需要座位数</label>
              <input id="p_seats" type="number" min="1" value="1" />
            </div>
            <div class="sm:col-span-2 lg:col-span-1 flex items-end">
              <button id="btnSearch" class="w-full rounded-xl bg-black text-white px-4 py-2 text-sm font-semibold">搜索班次</button>
            </div>
          </div>

          <div class="mt-6">
            <h3 class="font-semibold">可预约班次</h3>
            <div id="searchResults" class="mt-3 grid gap-3"></div>
          </div>

          <dialog id="bookDialog" class="rounded-2xl p-0 w-[min(580px,90vw)]">
            <form method="dialog" class="rounded-2xl bg-white border border-slate-200 shadow-lg overflow-hidden">
              <div class="px-6 py-4 border-b flex items-center justify-between">
                <h4 class="font-semibold">提交预约请求</h4>
                <button class="px-2 py-1" value="close">✕</button>
              </div>
              <div class="p-6 grid sm:grid-cols-2 gap-4">
                <div class="sm:col-span-2 text-sm text-slate-600" id="bookInfo"></div>
                <div>
                  <label>你的姓名</label>
                  <input id="b_name" required placeholder="张三" />
                </div>
                <div>
                  <label>联系方式（电话/微信/邮箱）</label>
                  <input id="b_contact" required placeholder="手机号或微信号" />
                </div>
                <div class="sm:col-span-2">
                  <label>备注</label>
                  <textarea id="b_note" rows="3" placeholder="如携带行李、婴儿座椅等"></textarea>
                </div>
              </div>
              <div class="px-6 py-4 border-t flex items-center justify-end gap-3 bg-slate-50">
                <button class="rounded-xl border border-slate-300 px-4 py-2 text-sm" value="cancel">取消</button>
                <button id="btnSubmitBooking" class="rounded-xl bg-black text-white px-4 py-2 text-sm font-semibold" value="default">提交</button>
              </div>
            </form>
          </dialog>
        </div>

        <!-- 司机面板 -->
        <div id="driver" class="rounded-2xl bg-white border border-slate-200 p-6 shadow-sm fade-in">
          <h2 class="text-xl font-bold">司机 · 发布班次与查看请求</h2>
          <p class="mt-1 text-sm text-slate-600">添加/管理你的行程；乘客的预约请求会出现在下方“收到的请求”。</p>

          <div class="mt-4 grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
            <div>
              <label>司机姓名</label>
              <input id="d_name" placeholder="李四" />
            </div>
            <div>
              <label>联系方式（仅对预约乘客可见）</label>
              <input id="d_contact" placeholder="手机号或微信号" />
            </div>
            <div>
              <label>出发城市</label>
              <input id="d_from" placeholder="例如：上海" />
            </div>
            <div>
              <label>到达城市</label>
              <input id="d_to" placeholder="例如：杭州" />
            </div>
            <div>
              <label>日期</label>
              <input id="d_date" type="date" />
            </div>
            <div>
              <label>出发时间</label>
              <input id="d_time" type="time" />
            </div>
            <div>
              <label>可用座位</label>
              <input id="d_seats" type="number" min="1" value="3" />
            </div>
            <div>
              <label>备注</label>
              <input id="d_note" placeholder="如上门接送/中途站点等" />
            </div>
            <div class="sm:col-span-2 lg:col-span-4 flex items-end justify-end">
              <button id="btnAddSchedule" class="rounded-xl bg-black text-white px-4 py-2 text-sm font-semibold">+ 发布班次</button>
            </div>
          </div>

          <div class="mt-6">
            <h3 class="font-semibold">我的班次</h3>
            <div id="driverSchedules" class="mt-3 grid gap-3"></div>
          </div>

          <div class="mt-6">
            <h3 class="font-semibold">收到的预约请求</h3>
            <div id="driverRequests" class="mt-3 grid gap-3"></div>
          </div>
        </div>
      </section>

      <!-- 右侧：说明/状态 -->
      <aside id="how" class="space-y-4">
        <div class="rounded-2xl bg-white border border-slate-200 p-6 shadow-sm">
          <h3 class="font-semibold">平台说明（MVP）</h3>
          <ul class="mt-2 text-sm text-slate-600 list-disc list-inside space-y-1">
            <li>这是前端原型：数据保存在浏览器 <code>localStorage</code>；刷新不丢失但不共享。</li>
            <li>乘客按城市/日期/座位筛选；提交预约后，司机会在“收到的预约请求”看到信息。</li>
            <li>要上线真实服务：建议接入账号系统、后端数据库（如 Supabase/Firebase）、短信/微信通知。</li>
          </ul>
        </div>
        <div class="rounded-2xl bg-white border border-slate-200 p-6 shadow-sm">
          <h3 class="font-semibold">下一步可做</h3>
          <ol class="mt-2 text-sm text-slate-600 list-decimal list-inside space-y-1">
            <li>城市字段改为选择器并做常用城市预设；增加价格/拼车规则。</li>
            <li>支持往返与循环日程（每周 X/周末等）。</li>
            <li>加入账号与司机认证、评价体系、取消/改签流程。</li>
            <li>加入支付与托管（如 Stripe/微信支付）与风控。</li>
          </ol>
        </div>
        <div class="rounded-2xl bg-white border border-slate-200 p-6 shadow-sm text-sm text-slate-600">
          <p class="mb-2 font-semibold">数据调试</p>
          <div class="flex gap-2">
            <button id="btnSeed" class="rounded-xl border border-slate-300 px-3 py-1">生成示例数据</button>
            <button id="btnClear" class="rounded-xl border border-slate-300 px-3 py-1">清空本地数据</button>
          </div>
          <p class="mt-2 text-xs">仅影响本浏览器，不会上传。</p>
        </div>
      </aside>
    </div>
  </main>

  <footer class="border-t border-slate-200">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8 text-sm text-slate-600 flex flex-col sm:flex-row items-center justify-between gap-4">
      <p>© <span id="year"></span> 城际同行</p>
      <div class="flex items-center gap-4">
        <a class="hover:text-black" href="#">隐私政策（示例）</a>
        <a class="hover:text-black" href="#">使用条款（示例）</a>
      </div>
    </div>
  </footer>

  <template id="tplScheduleCard">
    <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
      <div class="flex items-center justify-between gap-3">
        <div class="text-sm">
          <div class="font-semibold"><span data-from></span> → <span data-to></span> · <span data-date></span> <span data-time></span></div>
          <div class="text-slate-600 mt-1">司机：<span data-driver></span> · 座位：<span data-seats></span> · <span data-note></span></div>
        </div>
        <div class="flex items-center gap-2">
          <button data-book class="rounded-xl bg-black text-white px-3 py-1.5 text-xs font-semibold">预约</button>
        </div>
      </div>
    </div>
  </template>

  <template id="tplDriverScheduleRow">
    <div class="rounded-xl border border-slate-200 bg-white p-3">
      <div class="text-sm flex flex-wrap gap-x-3 gap-y-1 items-center justify-between">
        <div><span data-from></span> → <span data-to></span> · <span data-date></span> <span data-time></span> · 座位 <span data-seats></span> · <span data-note></span></div>
        <div class="flex items-center gap-2">
          <button data-del class="rounded-lg border border-slate-300 px-2 py-1 text-xs">删除</button>
        </div>
      </div>
    </div>
  </template>

  <template id="tplRequestCard">
    <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
      <div class="text-sm">
        <div class="font-semibold">来自 <span data-name></span> 的预约请求</div>
        <div class="text-slate-600 mt-1">联系方式：<span data-contact></span></div>
        <div class="text-slate-600">班次：<span data-from></span> → <span data-to></span> · <span data-date></span> <span data-time></span></div>
        <div class="text-slate-600">备注：<span data-note></span></div>
      </div>
    </div>
  </template>

  <script>
  // ---- 简易数据层（localStorage） ----
  const LS_KEYS = { drivers: 'cj_drivers', schedules: 'cj_schedules', requests: 'cj_requests' };
  const readLS = (k) => JSON.parse(localStorage.getItem(k) || '[]');
  const writeLS = (k, v) => localStorage.setItem(k, JSON.stringify(v));

  function uid(){ return Math.random().toString(36).slice(2,10); }

  // 年份
  document.getElementById('year').textContent = new Date().getFullYear();

  // 元素引用
  const els = {
    p_from: document.getElementById('p_from'),
    p_to: document.getElementById('p_to'),
    p_date: document.getElementById('p_date'),
    p_seats: document.getElementById('p_seats'),
    btnSearch: document.getElementById('btnSearch'),
    searchResults: document.getElementById('searchResults'),

    d_name: document.getElementById('d_name'),
    d_contact: document.getElementById('d_contact'),
    d_from: document.getElementById('d_from'),
    d_to: document.getElementById('d_to'),
    d_date: document.getElementById('d_date'),
    d_time: document.getElementById('d_time'),
    d_seats: document.getElementById('d_seats'),
    d_note: document.getElementById('d_note'),
    btnAddSchedule: document.getElementById('btnAddSchedule'),
    driverSchedules: document.getElementById('driverSchedules'),
    driverRequests: document.getElementById('driverRequests'),

    btnSeed: document.getElementById('btnSeed'),
    btnClear: document.getElementById('btnClear'),

    tplScheduleCard: document.getElementById('tplScheduleCard'),
    tplDriverScheduleRow: document.getElementById('tplDriverScheduleRow'),
    tplRequestCard: document.getElementById('tplRequestCard'),

    bookDialog: document.getElementById('bookDialog'),
    bookInfo: document.getElementById('bookInfo'),
    b_name: document.getElementById('b_name'),
    b_contact: document.getElementById('b_contact'),
    b_note: document.getElementById('b_note'),
    btnSubmitBooking: document.getElementById('btnSubmitBooking'),
  };

  // 当前司机临时身份（基于名字+联系信息）
  function currentDriverId(){
    const name = els.d_name.value.trim();
    const contact = els.d_contact.value.trim();
    if(!name || !contact) return null;
    const key = `${name}__${contact}`;
    let drivers = readLS(LS_KEYS.drivers);
    let found = drivers.find(d => d.key === key);
    if(!found){
      found = { id: uid(), key, name, contact };
      drivers.push(found); writeLS(LS_KEYS.drivers, drivers);
    }
    return found.id;
  }

  // 添加班次
  els.btnAddSchedule.addEventListener('click', () => {
    const did = currentDriverId();
    if(!did){ alert('请先填写“司机姓名”和“联系方式”。'); return; }
    const from = els.d_from.value.trim();
    const to = els.d_to.value.trim();
    const date = els.d_date.value;
    const time = els.d_time.value;
    const seats = parseInt(els.d_seats.value||'0',10);
    const note = els.d_note.value.trim();
    if(!from || !to || !date || !time || !seats){ alert('请完整填写出发/到达/日期/时间/座位。'); return; }
    const schedules = readLS(LS_KEYS.schedules);
    schedules.push({ id: uid(), driverId: did, from, to, date, time, seats, note });
    writeLS(LS_KEYS.schedules, schedules);
    renderDriverSchedules();
    alert('已发布班次');
  });

  // 渲染司机的班次
  function renderDriverSchedules(){
    const did = currentDriverId();
    const list = readLS(LS_KEYS.schedules).filter(s => s.driverId === did);
    els.driverSchedules.innerHTML = '';
    list.forEach(s => {
      const node = els.t
